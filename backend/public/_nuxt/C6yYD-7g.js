import"./CVOtDZBH.js";import{M as y,E as i,f as w}from"./CaTnqm11.js";import{_ as k,r as b,j as d,c as g,a as e,k as r,l as p,v as u,m as f,n as _,t as x,p as S,q as E,o as R}from"./EwCbqKW-.js";import"./DkAOjvrk.js";import"./CIa6fhAL.js";import"./DJ49jiU5.js";const T={class:"wrap"},M={class:"top-box"},C=["innerHTML"],B={class:"bottom-box"},K={class:"input-box"},H={class:"toolbar"},L={class:"type"},N={class:"right"},O={class:"status"},U=["onKeydown"],V={__name:"check",setup(j){const t=b({status:"",type:"",content:"",result:"",resultRef:d("result"),contentRef:d("content")}),v=()=>{t.status="",t.type="",t.content="",t.result=""},h=y(),m=S(),l=async()=>{if(!t.type){i.error("请输入质控类型");return}if(!t.content){i.error("请输入质控内容");return}t.status="正在运行质控...";const c=m.public.BASE_URL+"/api/client/check",s=new AbortController;let o="";await w(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t.type,content:t.content}),signal:s.signal,async onopen(n){if(n.ok&&n.headers.get("content-type")?.includes("text/event-stream"))console.log("✅ SSE opened");else throw new Error(await n.text())},async onmessage(n){try{const a=JSON.parse(n.data);o+=a.data.text||"",t.result=h.render(o.replace(/<think>[\s\S]*?<\/think>/g,"")),a.event==="workflow_finished"&&(t.status=""),await E(),t.resultRef.scrollTo({top:t.resultRef.scrollHeight,behavior:"smooth"})}catch{}},onerror(n){console.error(n),s.abort()},onclose(){t.status="",console.log("🔚 SSE closed")}})};return(c,s)=>(R(),g("div",T,[s[3]||(s[3]=e("div",{class:"title"},"辅助质控",-1)),e("div",M,[e("div",{ref:"result",innerHTML:r(t).result,class:"result"},null,8,C)]),e("div",B,[e("div",K,[e("div",H,[e("div",null,[e("div",L,[p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>r(t).type=o),onKeydown:s[1]||(s[1]=f(_(o=>r(t).contentRef.focus(),["prevent"]),["enter"])),type:"text",placeholder:"请输入质控类型"},null,544),[[u,r(t).type]])])]),e("div",N,[e("div",O,x(r(t).status),1),e("div",{onClick:v,class:"clean"})])]),p(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=o=>r(t).content=o),onKeydown:f(_(l,["prevent"]),["enter"]),ref:"content",placeholder:"请输入质控内容",class:"input"},null,40,U),[[u,r(t).content]]),e("div",{class:"bottom"},[e("div",{onClick:l,class:"submit"})])])])]))}},$=k(V,[["__scopeId","data-v-2625b10e"]]);export{$ as default};
