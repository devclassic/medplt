import"./CVOtDZBH.js";import{M as b,E as x,f as y}from"./CaTnqm11.js";import{_ as k,r as h,j as S,c,a as t,F as R,s as T,k as i,l as E,t as C,v as M,m as B,n as H,q as _,p as L,o as p,x as K}from"./EwCbqKW-.js";import{a as N}from"./CUsWJ9UZ.js";import"./DkAOjvrk.js";import"./CIa6fhAL.js";import"./DJ49jiU5.js";const O={class:"wrap"},j={class:"top-box"},A={ref:"result",class:"result"},D=["innerHTML"],F={class:"bottom-box"},I={class:"input-box"},J={class:"toolbar"},U={class:"right"},V={class:"status"},q=["onKeydown"],z={__name:"assist",setup(P){const s=h({status:"",prompt:"",messages:[],resultRef:S("result")});let n=!1;const d=N(),f=async()=>{if(!n)s.status=d.start(()=>{s.status="录音中...",n=!0},()=>{s.status="录音失败...",n=!1});else{s.status="正在识别...";const r=await d.getResult();s.prompt=r.data[0].text,s.status="",n=!1}},g=()=>{s.status="",s.prompt="",s.messages=[]},v=b(),w=L(),u=async()=>{if(!s.prompt){x.error("请输入提示词");return}s.messages.push({pos:"right",content:s.prompt}),await _(),s.resultRef.scrollTo({top:s.resultRef.scrollHeight,behavior:"smooth"});const r=h({content:""});s.messages.push(r),s.status="生成中...";const e=w.public.BASE_URL+"/api/client/assist",o=new AbortController;let m="";await y(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s.prompt}),signal:o.signal,async onopen(a){if(a.ok&&a.headers.get("content-type")?.includes("text/event-stream"))s.prompt="",console.log("✅ SSE opened");else throw new Error(await a.text())},async onmessage(a){try{const l=JSON.parse(a.data);m+=l.answer||"",r.content=v.render(m.replace(/<think>[\s\S]*?<\/think>/g,"")),l.event==="message_end"&&(s.status=""),await _(),s.resultRef.scrollTo({top:s.resultRef.scrollHeight,behavior:"smooth"})}catch{}},onerror(a){console.error(a),o.abort()},onclose(){s.status="",console.log("🔚 SSE closed")}})};return(r,e)=>(p(),c("div",O,[e[2]||(e[2]=t("div",{class:"title"},"辅助诊疗",-1)),t("div",j,[t("div",A,[(p(!0),c(R,null,T(i(s).messages,o=>(p(),c("div",{class:K([{right:o.pos==="right"},"item"])},[t("div",{innerHTML:o.content,class:"content"},null,8,D)],2))),256))],512)]),t("div",F,[t("div",I,[t("div",J,[e[1]||(e[1]=t("div",null,null,-1)),t("div",U,[t("div",V,C(i(s).status),1),t("div",{onClick:f,class:"speech"}),t("div",{onClick:g,class:"clean"})])]),E(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=o=>i(s).prompt=o),onKeydown:B(H(u,["prevent"]),["enter"]),placeholder:"请输入提示词",class:"input"},null,40,q),[[M,i(s).prompt]]),t("div",{class:"bottom"},[t("div",{onClick:u,class:"submit"})])])])]))}},ss=k(z,[["__scopeId","data-v-6f24b12c"]]);export{ss as default};
