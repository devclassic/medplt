import{E as D}from"./DNE9nDJw.js";import"./CVOtDZBH.js";import{M,E as g,f as L}from"./CaTnqm11.js";import{_ as V,r as x,j as f,c as m,a as t,b as B,F as h,s as k,k as n,l as P,t as A,v as H,m as N,n as O,w as j,p as K,q as C,o as p,x as $}from"./EwCbqKW-.js";import{u as I,a as J}from"./CUsWJ9UZ.js";import"./BYrQAmaY.js";import"./daoBXWbk.js";import"./DJ49jiU5.js";import"./CIa6fhAL.js";import"./Dad0xDRF.js";import"./r1GSfbrt.js";import"./DkAOjvrk.js";const q={class:"wrap"},z={class:"top-box"},G={ref:"result",class:"result"},Q=["innerHTML"],W={class:"bottom-box"},X={class:"input-box"},Y={class:"toolbar"},Z={class:"left"},ee={class:"right"},te={class:"status"},se=["onKeydown"],oe={class:"image-box"},ie={class:"images"},ae=["onClick","src"],le=["src"],ne={__name:"image",setup(re){const v=I(),e=x({messages:[],prompt:"",showPreview:!1,previewUrl:"",images:[],imgs:[],status:"",history:[{role:"system",content:[{type:"text",text:"‰Ω†ÊòØÁ´ØÁÇπÁßëÊäÄ‰∏ì‰∏öÂåªÁñóÂΩ±ÂÉèÂä©Êâã"}]}],imgFileRef:f("imgfile"),dcmFileRef:f("dcmfile"),resultRef:f("result")}),R=a=>{e.images=[];const o=a.target.files;for(let l=0;l<o.length;l++){const s=o[l];e.images.push(URL.createObjectURL(s))}},b=async a=>{e.imgFileRef.value=null,e.status="‰∏ä‰º†DCMÂΩ±ÂÉè‰∏≠...",e.images=[];const o=new FormData,l=a.target.files;for(let r=0;r<l.length;r++){const i=l[r];o.append("files",i)}const s=await v.post("/api/client/image/updcm",o,{headers:{"Content-Type":"multipart/form-data"}});s.data.success?(e.images=s.data.data.images.map(r=>w.public.BASE_URL+r),e.imgs=s.data.data.imgs):g.error(s.data.message),e.status=""};let d=!1;const _=J(),F=async()=>{if(!d)e.status=_.start(()=>{e.status="ÂΩïÈü≥‰∏≠...",d=!0},()=>{e.status="ÂΩïÈü≥Â§±Ë¥•...",d=!1});else{e.status="Ê≠£Âú®ËØÜÂà´...";const a=await _.getResult();e.prompt=a.data[0].text,e.status="",d=!1}},S=a=>{e.previewUrl=a,e.showPreview=!0},E=()=>{e.messages=[],e.images=[],e.imgs=[],e.status="",e.prompt="",e.history=[{role:"system",content:[{type:"text",text:"‰Ω†ÊòØÁ´ØÁÇπÁßëÊäÄ‰∏ì‰∏öÂåªÁñóÂΩ±ÂÉèÂä©Êâã"}]}]},T=M(),w=K(),y=async()=>{if(e.images.length===0){g.error("ËØ∑‰∏ä‰º†ÂΩ±ÂÉè");return}if(!e.prompt){g.error("ËØ∑ËæìÂÖ•ÊèêÁ§∫ËØç");return}e.messages.push({pos:"right",content:e.prompt}),await C(),e.resultRef.scrollTo({top:e.resultRef.scrollHeight,behavior:"smooth"});const a=x({content:""});e.messages.push(a),e.status="‰∏ä‰º†ÂΩ±ÂÉè‰∏≠...";const o=e.imgFileRef.files;if(o.length>0){const i=new FormData;for(let u=0;u<o.length;u++){const U=o[u];i.append("files",U)}const c=await v.post("/api/client/image/upimg",i,{headers:{"Content-Type":"multipart/form-data"}});e.status="ÂΩ±ÂÉè‰∏ä‰º†ÂÆåÊàê...",e.imgs=c.data.data}e.status="Ê≠£Âú®Â§ÑÁêÜ...";const l=w.public.BASE_URL+"/api/client/image",s=new AbortController;let r="";await L(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,history:e.history,imgs:e.imgs}),signal:s.signal,async onopen(i){if(i.ok&&i.headers.get("content-type")?.includes("text/event-stream"))e.prompt="",console.log("‚úÖ SSE opened");else throw new Error(await i.text())},async onmessage(i){try{const c=JSON.parse(i.data);r+=c.token||"",a.content=T.render(r.replace(/<think>[\s\S]*?<\/think>/g,"")),c.event==="message_end"&&(e.status=""),await C(),e.resultRef.scrollTo({top:e.resultRef.scrollHeight,behavior:"smooth"})}catch{}},onerror(i){console.error(i),s.abort()},onclose(){e.status="",console.log("üîö SSE closed")}})};return(a,o)=>{const l=D;return p(),m(h,null,[t("div",q,[o[4]||(o[4]=t("div",{class:"title"},"ËæÖÂä©ÂΩ±ÂÉè",-1)),t("div",z,[t("div",G,[(p(!0),m(h,null,k(n(e).messages,s=>(p(),m("div",{class:$([{right:s.pos==="right"},"item"])},[t("div",{innerHTML:s.content,class:"content"},null,8,Q)],2))),256))],512)]),t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("input",{onChange:R,ref:"imgfile",type:"file",accept:"image/*",multiple:"",class:"file"},null,544),t("input",{onChange:b,ref:"dcmfile",type:"file",multiple:"",class:"file"},null,544),t("div",{onClick:o[0]||(o[0]=s=>n(e).imgFileRef.click()),class:"upimage"}),t("div",{onClick:o[1]||(o[1]=s=>n(e).dcmFileRef.click()),class:"updicom"})]),t("div",ee,[t("div",te,A(n(e).status),1),t("div",{onClick:F,class:"speech"}),t("div",{onClick:E,class:"clean"})])]),P(t("textarea",{"onUpdate:modelValue":o[2]||(o[2]=s=>n(e).prompt=s),onKeydown:N(O(y,["prevent"]),["enter"]),placeholder:"ËØ∑‰∏ä‰º†ÁâáÂ≠êÂπ∂ËæìÂÖ•Áõ∏ÂÖ≥ÈóÆÈ¢ò",class:"input"},null,40,se),[[H,n(e).prompt]]),t("div",{class:"bottom"},[t("div",{onClick:y,class:"submit"})])]),t("div",oe,[t("div",ie,[(p(!0),m(h,null,k(n(e).images,s=>(p(),m("img",{onClick:r=>S(s),src:s,class:"img"},null,8,ae))),256))])])])]),B(l,{modelValue:n(e).showPreview,"onUpdate:modelValue":o[3]||(o[3]=s=>n(e).showPreview=s),title:"ÂõæÂÉèÈ¢ÑËßà",width:"800"},{default:j(()=>[t("img",{src:n(e).previewUrl,class:"preview"},null,8,le)]),_:1},8,["modelValue"])],64)}}},xe=V(ne,[["__scopeId","data-v-f5f93220"]]);export{xe as default};
