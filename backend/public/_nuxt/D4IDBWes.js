import{E as I}from"./DU06vKIJ.js";import"./CEbQVcMT.js";import{M as Z,E as w,f as x}from"./D9lis7FZ.js";import{_ as E,r as v,g as u,c,a as s,b as Y,F as f,j as M,k as l,l as O,t as b,v as z,m as S,n as k,w as L,p as G,q as U,o as m,s as P}from"#entry";import{u as V,a as J}from"./Cs3dzKIV.js";import"./p4-vezJD.js";import"./C4gErKuu.js";import"./CBheTNdn.js";import"./B3xDuC8R.js";import"./BRE3uSYE.js";import"./CNSWhatW.js";import"./pn8GBfzJ.js";const C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABZCAIAAAF/PiU2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAzIDc5Ljk2OTBhODdmYywgMjAyNS8wMy8wNi0yMDo1MDoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4MjJmYjkwYS00ZGU5LTQxNGItYWI1YS1mODFlNjlmMTE1MjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDgwOUFBMjdBN0RDMTFGMDg1MERDOUE4RTNDMTExODkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDgwOUFBMjZBN0RDMTFGMDg1MERDOUE4RTNDMTExODkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTNhNjg1ZjgtNjc5ZS00ODQ0LTg4ODgtNGNlMTI2NTZkZGQzIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6M2NmMTVmZjgtNTAwNC01NDRjLTk2MmQt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",H={class:"wrap"},W={class:"top-box"},F={ref:"result",class:"result"},Q=["innerHTML"],X={class:"bottom-box"},_={class:"input-box"},q={class:"toolbar"},K={class:"left"},$={class:"right"},tt={class:"status"},st=["onKeydown"],et={class:"image-box"},ot={class:"images"},it={class:"doc"},lt={style:{position:"relative"}},at=["src"],nt={style:{transform:"translate(0, 70px)"}},rt=["src"],ct={__name:"file",setup(mt){const N=J(),t=v({messages:[],prompt:"",showPreview:!1,previewUrl:"",files:[],imgs:[],status:"",history:[{role:"system",content:[{type:"text",text:"你是端点科技专业医疗影像助手"}]}],imgFileRef:u("imgfile"),dcmFileRef:u("dcmfile"),resultRef:u("result")}),y=a=>{t.files=[];const o=a.target.files;for(let n=0;n<o.length;n++){const e=o[n];console.log(e),t.files.push({name:e.name,src:C})}};let p=!1;const g=V(),R=async()=>{if(!p)t.status=g.start(()=>{t.status="录音中...",p=!0},()=>{t.status="录音失败...",p=!1});else{t.status="正在识别...";const a=await g.getResult();t.prompt=a.data[0].text,t.status="",p=!1}},T=()=>{t.messages=[],t.file=[],t.imgs=[],t.status="",t.prompt="",t.history=[{role:"system",content:[{type:"text",text:"你是端点科技专业医疗影像助手"}]}]},D=Z(),j=U(),h=async()=>{if(t.files.length===0){w.error("请上传文档");return}if(!t.prompt){w.error("请输入提示词");return}t.messages.push({pos:"right",content:t.prompt}),await G(),t.resultRef.scrollTo({top:t.resultRef.scrollHeight,behavior:"smooth"});const a=v({content:""});t.messages.push(a),t.status="上传文档中...";const o=t.imgFileRef.files;if(o.length>0){const i=new FormData;for(let d=0;d<o.length;d++){const B=o[d];i.append("files",B)}const r=await N.post("/api/client/file/upfile",i,{headers:{"Content-Type":"multipart/form-data"}});t.status="文档上传完成...",t.imgs=r.data.data}t.status="正在处理...";const n=j.public.BASE_URL+"/api/client/file",e=new AbortController;let A="";await x(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t.prompt,history:t.history,imgs:t.imgs}),signal:e.signal,async onopen(i){if(i.ok&&i.headers.get("content-type")?.includes("text/event-stream"))t.prompt="",console.log("✅ SSE opened");else throw new Error(await i.text())},async onmessage(i){try{const r=JSON.parse(i.data);console.log(r),A+=r.answer||"",a.content=D.render(A.replace(/<think>[\s\S]*?<\/think>/g,"")),r.event==="message_end"&&(t.status=""),await G(),t.resultRef.scrollTo({top:t.resultRef.scrollHeight,behavior:"smooth"})}catch{}},onerror(i){console.error(i),e.abort()},onclose(){t.status="",console.log("🔚 SSE closed")}})};return(a,o)=>{const n=I;return m(),c(f,null,[s("div",H,[o[3]||(o[3]=s("div",{class:"title"},"文档分析",-1)),s("div",W,[s("div",F,[(m(!0),c(f,null,M(l(t).messages,e=>(m(),c("div",{class:P([{right:e.pos==="right"},"item"])},[s("div",{innerHTML:e.content,class:"content"},null,8,Q)],2))),256))],512)]),s("div",X,[s("div",_,[s("div",q,[s("div",K,[s("input",{onChange:y,ref:"imgfile",type:"file",multiple:"",class:"file"},null,544),s("div",{onClick:o[0]||(o[0]=e=>l(t).imgFileRef.click()),class:"upimage"})]),s("div",$,[s("div",tt,b(l(t).status),1),s("div",{onClick:R,class:"speech"}),s("div",{onClick:T,class:"clean"})])]),O(s("textarea",{"onUpdate:modelValue":o[1]||(o[1]=e=>l(t).prompt=e),onKeydown:S(k(h,["prevent"]),["enter"]),placeholder:"请上传片子并输入相关问题",class:"input"},null,40,st),[[z,l(t).prompt]]),s("div",{class:"bottom"},[s("div",{onClick:h,class:"submit"})])]),s("div",et,[s("div",ot,[(m(!0),c(f,null,M(l(t).files,e=>(m(),c("div",it,[s("div",lt,[s("img",{src:e.src,class:"img",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,8,at),s("div",nt,b(e.name),1)])]))),256))])])])]),Y(n,{modelValue:l(t).showPreview,"onUpdate:modelValue":o[2]||(o[2]=e=>l(t).showPreview=e),title:"图像预览",width:"800"},{default:L(()=>[s("img",{src:l(t).previewUrl,class:"preview"},null,8,rt)]),_:1},8,["modelValue"])],64)}}},Nt=E(ct,[["__scopeId","data-v-8152229d"]]);export{Nt as default};
